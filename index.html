<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>ðŸŽ¯ Ambition Tracker</title>
  <style>
    body { font-family:sans-serif; padding:20px; max-width:800px; margin:auto; }
    .progress-bar { height:20px; background:#eee; border-radius:10px; overflow:hidden; }
    .progress-bar-inner { height:100%; background:linear-gradient(90deg,#4caf50,#81c784); width:0%; transition: width 0.3s; }
    .goal { padding:10px; margin:10px 0; border-radius:10px; background:#f0f0f0; }
    .heatmap { display:grid; grid-template-columns:repeat(30,1fr); gap:2px; margin-top:5px; }
    .day { width:10px; height:10px; background:#ddd; border-radius:2px; }
    .day[data-count="1"] { background:#c8e6c9; }
    .day[data-count="2"] { background:#81c784; }
    .day[data-count="3"] { background:#4caf50; }
    .day[data-count="4"] { background:#2e7d32; }
    .day[data-count="5"] { background:#1b5e20; }
    .badge { display:inline-block; background:gold; padding:4px 8px; border-radius:8px; margin:3px; }
  </style>
</head>
<body>
  <h1>ðŸŽ¯ Ambition Tracker</h1>

  <label for="user-select">User:</label>
  <select id="user-select"></select>
  <button id="add-user">Add User</button>
  <button id="add-goal">Add Goal</button>

  <div class="progress-bar" style="margin-top:20px;">
    <div id="xp-bar-inner" class="progress-bar-inner"></div>
  </div>
  <p id="xp-info"></p>
  <p id="streak-info"></p>
  <div id="rewards"></div>

  <div id="dashboard"></div>

  <script type="module">
    // --- Daten laden & speichern ---
    function loadUsers() {
      return JSON.parse(localStorage.getItem("users") || "{}");
    }
    function saveUsers(users) {
      localStorage.setItem("users", JSON.stringify(users));
    }

    // --- UI Referenzen ---
    const userSelect = document.getElementById("user-select");
    const addUserBtn = document.getElementById("add-user");
    const addGoalBtn = document.getElementById("add-goal");
    const dashboard = document.getElementById("dashboard");
    const xpBarInner = document.getElementById("xp-bar-inner");
    const xpInfo = document.getElementById("xp-info");
    const streakInfo = document.getElementById("streak-info");
    const rewardsDiv = document.getElementById("rewards");

    let users = loadUsers();
    let currentUser = null;

    function updateUserSelect() {
      userSelect.innerHTML = "";
      Object.keys(users).forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        userSelect.appendChild(opt);
      });
      if (!currentUser && Object.keys(users).length > 0) {
        currentUser = Object.keys(users)[0];
      }
      if (currentUser) {
        userSelect.value = currentUser;
      }
      renderDashboard();
    }

    function addUser() {
      const name = prompt("Neuer Benutzername:");
      if (!name) return;
      if (users[name]) return alert("User existiert schon!");
      users[name] = { goals: [], xp: 0, streak: 0, lastCheckIn: null, badges: [] };
      saveUsers(users);
      currentUser = name;
      updateUserSelect();
    }

    function addGoal() {
      if (!currentUser) return alert("Bitte erst User auswÃ¤hlen!");
      const title = prompt("Zielbeschreibung:");
      if (!title) return;
      users[currentUser].goals.push({ title, progress: [] });
      saveUsers(users);
      renderDashboard();
    }

    function toggleDay(goalIndex, day) {
      const g = users[currentUser].goals[goalIndex];
      const i = g.progress.indexOf(day);
      if (i >= 0) {
        g.progress.splice(i,1);
      } else {
        g.progress.push(day);
        grantXP(10);
      }
      saveUsers(users);
      renderDashboard();
    }

    function grantXP(amount) {
      const u = users[currentUser];
      u.xp += amount;
      const today = new Date().toDateString();
      if (u.lastCheckIn === today) {
        // streak already counted today
      } else {
        const yesterday = new Date(); yesterday.setDate(yesterday.getDate()-1);
        if (u.lastCheckIn === yesterday.toDateString()) {
          u.streak++;
        } else {
          u.streak = 1;
        }
        u.lastCheckIn = today;
      }
      if (u.streak === 7 && !u.badges.includes("ðŸ”¥ 7-Tage Streak")) {
        u.badges.push("ðŸ”¥ 7-Tage Streak");
      }
      saveUsers(users);
    }

    function renderDashboard() {
      if (!currentUser) return;
      const u = users[currentUser];
      dashboard.innerHTML = "";
      u.goals.forEach((g,gi) => {
        const div = document.createElement("div");
        div.className = "goal";
        div.innerHTML = "<strong>"+g.title+"</strong>";
        const heatmap = document.createElement("div");
        heatmap.className = "heatmap";
        const today = new Date();
        for (let i=29; i>=0; i--) {
          const d = new Date();
          d.setDate(today.getDate()-i);
          const dayStr = d.toDateString();
          const cell = document.createElement("div");
          cell.className = "day";
          const count = g.progress.filter(x => x===dayStr).length;
          if (count > 0) {
            cell.dataset.count = Math.min(count,5);
          }
          cell.title = dayStr;
          cell.addEventListener("click",()=>toggleDay(gi,dayStr));
          heatmap.appendChild(cell);
        }
        div.appendChild(heatmap);
        dashboard.appendChild(div);
      });

      // XP & Streak
      xpBarInner.style.width = (u.xp % 100)+"%";
      xpInfo.textContent = "XP: "+u.xp+" (Level "+Math.floor(u.xp/100)+")";
      streakInfo.textContent = "ðŸ”¥ Streak: "+u.streak+" Tage";
      rewardsDiv.innerHTML = "";
      u.badges.forEach(b => {
        const span = document.createElement("span");
        span.className="badge";
        span.textContent = b;
        rewardsDiv.appendChild(span);
      });
    }

    userSelect.addEventListener("change",()=>{currentUser=userSelect.value; renderDashboard();});
    addUserBtn.addEventListener("click", addUser);
    addGoalBtn.addEventListener("click", addGoal);

    updateUserSelect();
  </script>
</body>
</html>
